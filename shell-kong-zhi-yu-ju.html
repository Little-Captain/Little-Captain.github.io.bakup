<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Little Captain's Blog - shell 控制语句</title>
    <meta name="description" content="">
    <meta name="author" content="Little Captain">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
    <script src="http://littlecaptain.net/theme/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="http://littlecaptain.net/theme/bootstrap.min.css" rel="stylesheet">
    <link href="http://littlecaptain.net/theme/bootstrap.min.responsive.css" rel="stylesheet">
    <link href="http://littlecaptain.net/theme/local.css" rel="stylesheet">
    <link href="http://littlecaptain.net/theme/pygments.css" rel="stylesheet">

    <!-- So Firefox can bookmark->"abo this site" -->

</head>

<body>

<div class="navbar">
    <div class="navbar-inner">
    <div class="container">

         <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
             <span class="icon-bar"></span>
             <span class="icon-bar"></span>
             <span class="icon-bar"></span>
         </a>

        <a class="brand" href="http://littlecaptain.net">Little Captain's Blog</a>

        <div class="nav-collapse">
        <ul class="nav">
            
        </ul>
        </div>
        
    </div>
    </div>
</div>

<div class="container">
    <div class="content">
    <div class="row">

        <div class="span9">
    <div class='article'>
        <div class="content-title">
            <h1>shell 控制语句</h1>
Sun 13 August 2017

by <a class="url fn" href="http://littlecaptain.net/author/little-captain.html">Little Captain</a>
 


        </div>
	
        <div><h1 id="if-thenyu-ju">if-then语句</h1>
<ul>
<li>bash 的 if 语句会运行 if 行定义的那个命令. 如果命令的退出状态码是0, 位于 then 部分的命令会被执行</li>
</ul>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="nb">command</span>
<span class="k">then</span>
   commands
<span class="k">fi</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="k">if</span> command<span class="p">;</span> <span class="k">then</span>
   commands
<span class="k">fi</span>
</pre></div>
<h1 id="if-then-elseyu-ju">if-then-else语句</h1>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="nb">command</span>
<span class="k">then</span>
   commands
<span class="k">else</span>
   commands
<span class="k">fi</span>
</pre></div>
<h1 id="qian-tao-if">嵌套 if</h1>
<div class="highlight"><pre><span></span><span class="k">if</span> command1
<span class="k">then</span>
   commands
<span class="k">elif</span> command2
<span class="k">then</span>
   commands
<span class="k">fi</span>
</pre></div>
<h1 id="test-ming-ling">test 命令</h1>
<ul>
<li>如果 test 命令中列出的条件成立, test 命令就会退出并返回状态码 0</li>
</ul>
<div class="highlight"><pre><span></span><span class="nb">test</span> condition
</pre></div>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="nb">test</span> condition
<span class="k">then</span>
   commands
<span class="k">fi</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="c1"># test 命令的简写形式</span>
<span class="c1"># 方括号定义了 test 命令中用到的条件</span>
<span class="c1"># condition 左右的空格是必须的</span>
<span class="k">if</span> <span class="o">[</span> condition <span class="o">]</span>
<span class="k">then</span>
   commands
<span class="k">fi</span>
</pre></div>
<h2 id="shu-zhi-bi-jiao">数值比较</h2>
<p><strong>数值比较</strong></p>
<p><img align="center" src="../assets/images/Linux/数值比较.png" width="100%"/></p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[</span> <span class="nv">$val</span> -gt <span class="m">5</span> <span class="o">]</span>
<span class="k">then</span>
   <span class="nb">echo</span> <span class="s2">"The test value </span><span class="nv">$val</span><span class="s2"> is greater than 5"</span>
<span class="k">fi</span>
</pre></div>
<h2 id="zi-fu-chuan-bi-jiao">字符串比较</h2>
<p><strong>字符串比较</strong></p>
<p><img align="center" src="../assets/images/Linux/字符串比较.png" width="100%"/></p>
<ul>
<li>字符串大小比较</li>
<li>大于小于符号必须转义, 因为它们和重定向符号冲突</li>
<li>大于小于顺序和sort命令所采用的不同. 在 test 命令中, 大写字母小于小写字母. sort 命令, 则相反. test 命令使用标准的 ASCII 顺序. sort 命令使用系统的本地化语言设置中定义的排序顺序.</li>
</ul>
<h2 id="wen-jian-bi-jiao">文件比较</h2>
<p><strong>文件比较</strong></p>
<p><img align="center" src="../assets/images/Linux/文件比较.png" width="100%"/></p>
<h2 id="fu-he-tiao-jian-ce-shi">复合条件测试</h2>
<ul>
<li>[ condition1 ] &amp;&amp; [ condition2 ]</li>
<li>[ condition1 ] || [ condition2 ]</li>
</ul>
<h1 id="if-then-de-gao-ji-te-xing_1">if-then 的高级特性</h1>
<h2 id="shi-yong-shuang-jian-gua-hao">使用双尖括号</h2>
<ul>
<li>任意的数学<code>赋值</code>或<code>比较</code>表达式</li>
</ul>
<div class="highlight"><pre><span></span><span class="c1"># 可以放入类似C语言中的高级数学表达式</span>
<span class="o">((</span> expression <span class="o">))</span>
</pre></div>
<p><strong>双尖括号命令符号</strong></p>
<p><img align="center" src="../assets/images/Linux/双尖括号命令符号.png" width="100%"/></p>
<h2 id="shi-yong-shuang-fang-gua-hao">使用双方括号</h2>
<ul>
<li>支持 test 命令中的标准字符串比较</li>
<li>高级特性 : 模式匹配. 也就是你可以定义一个正则表达式来匹配字符串</li>
</ul>
<div class="highlight"><pre><span></span><span class="o">[[</span> expression <span class="o">]]</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[[</span> <span class="nv">$USER</span> <span class="o">==</span> r* <span class="o">]]</span>
<span class="k">then</span>
  <span class="nb">echo</span> Hello
<span class="k">fi</span>
</pre></div>
<h1 id="case-ming-ling_1">case 命令</h1>
<div class="highlight"><pre><span></span><span class="c1"># 一旦某个模式匹配了, 后面的模式将不会再进行匹配</span>
<span class="k">case</span> variable in
pattern1 <span class="p">|</span> pattern2<span class="o">)</span> commands1<span class="p">;;</span>
pattern3<span class="o">)</span> commands2<span class="p">;;</span>
*<span class="o">)</span> default commands<span class="p">;;</span>
<span class="k">esac</span>
</pre></div>
<h1 id="for-ming-ling">for 命令</h1>
<div class="highlight"><pre><span></span><span class="k">for</span> var in list
<span class="k">do</span>
  commands
<span class="k">done</span>
</pre></div>
<ul>
<li>list 中有特殊字符, 可以使用转义, 或使用引号括起来</li>
</ul>
<h2 id="cong-bian-liang-du-qu-lie-biao">从变量读取列表</h2>
<div class="highlight"><pre><span></span><span class="nv">list</span><span class="o">=</span><span class="s2">"Alabama Alaska Colorado"</span>
<span class="c1"># 向变量中添加文本字符串</span>
<span class="nv">list</span><span class="o">=</span><span class="nv">$list</span><span class="s2">" Arizona"</span>
<span class="k">for</span> state in <span class="nv">$list</span>
<span class="k">do</span>
  <span class="nb">echo</span> <span class="nv">$state</span>
<span class="k">done</span>
</pre></div>
<h2 id="cong-ming-ling-du-qu-zhi">从命令读取值</h2>
<div class="highlight"><pre><span></span><span class="nv">file</span><span class="o">=</span><span class="s2">"states"</span>
<span class="k">for</span> state in <span class="sb">`</span>cat <span class="nv">$file</span><span class="sb">`</span>
<span class="k">do</span>
  <span class="nb">echo</span> <span class="s2">"Visit beautiful </span><span class="nv">$state</span><span class="s2">"</span>
<span class="k">done</span>
</pre></div>
<h2 id="geng-gai-zi-duan-fen-ge-fu">更改字段分隔符</h2>
<blockquote>
<p>IFS 内部字段分隔符, 这个 bash 环境变量保存用作 bash 字段分隔符的字符. 默认的字段分隔符是: 空格、制表符、换行符</p>
</blockquote>
<ul>
<li>可以在 shell 脚本中改变 IFS的值, 当退出 shell 脚本时, IFS 会恢复默认值</li>
<li>当在一个脚本中, 需要恢复默认值时, 可以使用一个变量暂存</li>
</ul>
<div class="highlight"><pre><span></span><span class="c1"># 仅仅换行符</span>
<span class="nv">IFS</span><span class="o">=</span><span class="s1">$'\n'</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="c1"># shell 中暂存</span>
IFS.OLD<span class="o">=</span><span class="nv">$IFS</span>
<span class="nv">IFS</span><span class="o">=</span><span class="s1">$'\n'</span>
<span class="c1"># code</span>
<span class="nv">IFS</span><span class="o">=</span><span class="nv">$IFS</span>.OLD
</pre></div>
<div class="highlight"><pre><span></span><span class="c1"># 指定多个分隔符</span>
<span class="nv">IFS</span><span class="o">=</span><span class="s1">$'\n:;'</span> <span class="c1"># 换行符、冒号、分号</span>
</pre></div>
<h2 id="shi-yong-tong-pei-fu-du-qu-mu-lu">使用通配符读取目录</h2>
<ul>
<li>使用 for 命令遍历目录中的文件, 可以使用通配符</li>
<li>文件扩展通配 : 生成匹配指定的通配符的文件名或路径名的过程</li>
</ul>
<div class="highlight"><pre><span></span><span class="k">for</span> file in /home/rich/test/*
<span class="k">do</span>
  <span class="k">if</span> <span class="o">[</span> -d <span class="s2">"</span><span class="nv">$file</span><span class="s2">"</span> <span class="o">]</span>
  <span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$file</span><span class="s2"> is a directory"</span>
  <span class="k">elif</span> <span class="o">[</span> -f <span class="s2">"</span><span class="nv">$file</span><span class="s2">"</span> <span class="o">]</span>
  <span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$file</span><span class="s2"> is a file"</span>
  <span class="k">fi</span>
<span class="k">done</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="c1"># 在 for 命令中通过列出一系列的目录通配符来将目录查找方法和列表方法合并到同一个 for 语句中</span>
<span class="k">for</span> file in /home/rich/.b* /home/rich/badtest
<span class="k">do</span>
  <span class="k">if</span> <span class="o">[</span> -d <span class="s2">"</span><span class="nv">$file</span><span class="s2">"</span> <span class="o">]</span>
  <span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$file</span><span class="s2"> is a directory"</span>
  <span class="k">elif</span> <span class="o">[</span> -f <span class="s2">"</span><span class="nv">$file</span><span class="s2">"</span> <span class="o">]</span>
  <span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$file</span><span class="s2"> is a file"</span>
  <span class="k">fi</span>
<span class="k">done</span>
</pre></div>
<h1 id="cyu-yan-feng-ge-de-for-ming-ling_1">C语言风格的 for 命令</h1>
<div class="highlight"><pre><span></span><span class="k">for</span> <span class="o">((</span> variable assignment<span class="p">;</span> condition<span class="p">;</span> iteration process <span class="o">))</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="c1"># C 风格 for 命令</span>
<span class="k">for</span> <span class="o">((</span> <span class="nv">i</span> <span class="o">=</span> <span class="m">1</span><span class="p">;</span> i &lt;<span class="o">=</span> <span class="m">10</span><span class="p">;</span> ++i <span class="o">))</span>
<span class="k">do</span>
  <span class="nb">echo</span> <span class="s2">"The next number is </span><span class="nv">$i</span><span class="s2">"</span>
<span class="k">done</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="c1"># 使用多个变量</span>
<span class="k">for</span> <span class="o">((</span> <span class="nv">a</span> <span class="o">=</span> <span class="m">1</span>, <span class="nv">b</span> <span class="o">=</span> <span class="m">10</span><span class="p">;</span> a &lt;<span class="o">=</span> <span class="m">10</span><span class="p">;</span> ++a, --b <span class="o">))</span>
<span class="k">do</span>
  <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$a</span><span class="s2"> - </span><span class="nv">$b</span><span class="s2">"</span>
<span class="k">done</span>
</pre></div>
<h1 id="while-ming-ling">while 命令</h1>
<div class="highlight"><pre><span></span><span class="k">while</span> <span class="nb">test</span> <span class="nb">command</span>
<span class="k">do</span>
  other commands
<span class="k">done</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="nv">var1</span><span class="o">=</span><span class="m">10</span>
<span class="k">while</span> <span class="o">[</span> <span class="nv">$var1</span> -gt <span class="m">0</span> <span class="o">]</span>
<span class="k">do</span>
  <span class="nb">echo</span> <span class="nv">$var1</span>
  <span class="nv">var1</span><span class="o">=</span>$<span class="o">[</span> <span class="nv">$var1</span> - <span class="m">1</span> <span class="o">]</span>
<span class="k">done</span>
</pre></div>
<h2 id="shi-yong-duo-ge-ce-shi-ming-ling">使用多个测试命令</h2>
<ul>
<li>只有最后一个测试命令的退出状态码会被用来决定什么时候结束循环</li>
</ul>
<div class="highlight"><pre><span></span><span class="nv">var1</span><span class="o">=</span><span class="m">10</span>
<span class="k">while</span> <span class="nb">echo</span> <span class="nv">$var1</span>
      <span class="o">[</span> <span class="nv">$var1</span> -gt <span class="m">0</span> <span class="o">]</span>
<span class="k">do</span>
  <span class="nb">echo</span> <span class="s2">"This is inside the loop"</span>
  <span class="nv">var1</span><span class="o">=</span>$<span class="o">[</span> <span class="nv">$var1</span> - <span class="m">1</span> <span class="o">]</span>
<span class="k">done</span>
</pre></div>
<h1 id="until-ming-ling_1">until 命令</h1>
<ul>
<li>until 命令和while 命令工作的方式完全相反.</li>
<li>退出状态码非零, 循环执行; 退出状态码为零, 循环结束</li>
</ul>
<div class="highlight"><pre><span></span><span class="k">until</span> <span class="nb">test</span> commands
<span class="k">do</span>
  other commands
<span class="k">done</span>
</pre></div>
<h1 id="qian-tao-xun-huan">嵌套循环</h1>
<ul>
<li>循环套循环</li>
</ul>
<h1 id="kong-zhi-xun-huan">控制循环</h1>
<h2 id="break">break</h2>
<ul>
<li>跳出当前层循环</li>
</ul>
<div class="highlight"><pre><span></span><span class="nb">break</span>
</pre></div>
<ul>
<li>跳出指定层级的外部循环</li>
</ul>
<div class="highlight"><pre><span></span><span class="c1"># 默认 n 为 1, 向外递增</span>
<span class="nb">break</span> n
</pre></div>
<h2 id="continue">continue</h2>
<ul>
<li>继续当前层循环</li>
</ul>
<div class="highlight"><pre><span></span><span class="k">continue</span>
</pre></div>
<ul>
<li>继续指定层级的外部循环</li>
</ul>
<div class="highlight"><pre><span></span><span class="c1"># 默认 n 为 1, 向外递增</span>
<span class="k">continue</span> n
</pre></div>
<h1 id="chu-li-xun-huan-de-shu-chu_1">处理循环的输出</h1>
<ul>
<li>shell 中处理输出, 要么管接, 要么重定向</li>
</ul>
<div class="highlight"><pre><span></span><span class="c1"># done 后添加一个处理命令来处理输出</span>
<span class="k">for</span> file in /home/rich/*
<span class="k">do</span>
  <span class="c1"># code</span>
<span class="k">done</span> &gt; output.txt
</pre></div></div>
	
        <hr>

    </div>
        </div>
        
        <div class="span3">

            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Site
                </li>
            
                <li><a href="http://littlecaptain.net/archives.html">Archives</a>
                <li><a href="http://littlecaptain.net/tags.html">Tags</a>




            </ul>
            </div>


            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Categories
                </li>
                
                <li><a href="http://littlecaptain.net/category/c.html">C++</a></li>
                <li><a href="http://littlecaptain.net/category/git.html">git</a></li>
                <li><a href="http://littlecaptain.net/category/ios.html">iOS</a></li>
                <li><a href="http://littlecaptain.net/category/java.html">Java</a></li>
                <li><a href="http://littlecaptain.net/category/ji-suan-ji-wang-luo.html">计算机网络</a></li>
                <li><a href="http://littlecaptain.net/category/linux.html">Linux</a></li>
                <li><a href="http://littlecaptain.net/category/php.html">PHP</a></li>
                <li><a href="http://littlecaptain.net/category/pyqt.html">PyQt</a></li>
                <li><a href="http://littlecaptain.net/category/python.html">Python</a></li>
                <li><a href="http://littlecaptain.net/category/shell.html">shell</a></li>
                <li><a href="http://littlecaptain.net/category/svn.html">SVN</a></li>
                <li><a href="http://littlecaptain.net/category/tools.html">Tools</a></li>
                <li><a href="http://littlecaptain.net/category/xcode.html">Xcode</a></li>
                <li><a href="http://littlecaptain.net/category/za-tan.html">杂谈</a></li>
                <li><a href="http://littlecaptain.net/category/zheng-ze-biao-da-shi.html">正则表达式</a></li>
                   
            </ul>
            </div>


            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Links
                </li>
            
                <li><a href="https://github.com/Little-Captain">Github</a></li>
            </ul>
            </div>



        </div>  
    </div>     </div> 
<footer>
<br />
<p><a href="http://littlecaptain.net">Little Captain's Blog</a> &copy; Little Captain 2018</p>
</footer>

</div> <!-- /container -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script src="http://littlecaptain.net/theme/bootstrap-collapse.js"></script>
 
</body>
</html>